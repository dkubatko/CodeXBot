<!DOCTYPE html>
<html>
<body>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <p>You are connected</p>
    <br>Speech rate:<br>
    <input type="range" min="0" max="3" value="1" step="0.5" name="rate" id="rate"><p id="rate_o">1</p>
    <br>Pitch:<br>
    <input type="range" min="0" max="2" value="1" step="0.1" name="pitch" id="pitch"><p id="pitch_o">1</p>
    <br>Volume:<br>
    <input type="range" min="0" max="1" value="1" step="0.1" name="volume" id="volume"><p id="volume_o">1</p>
    <script type="text/javascript" charset="utf-8">
        var rate = document.getElementById("rate");
        var pitch = document.getElementById("pitch");
        var volume = document.getElementById("volume");
        var rate_o = document.getElementById("rate_o");
        var pitch_o = document.getElementById("pitch_o");
        var volume_o = document.getElementById("volume_o");
        
        rate_o.innerHTML = rate.value; // Display the default slider value
        // Update the current slider value (each time you drag the slider handle)
        rate.oninput = function() {
            rate_o.innerHTML = this.value;
        }
        
        pitch_o.innerHTML = pitch.value; // Display the default slider value
        // Update the current slider value (each time you drag the slider handle)
        pitch.oninput = function() {
            pitch_o.innerHTML = this.value;
        }
        
        volume_o.innerHTML = volume.value; // Display the default slider value
        // Update the current slider value (each time you drag the slider handle)
        volume.oninput = function() {
            volume_o.innerHTML = this.value;
        }
        
        var voiceReady = false;
        var synth = window.speechSynthesis;
        window.speechSynthesis.onvoiceschanged = function() {
            // only start upon voices loaded
            voiceReady = true;
        };
        function speak(message, lang) {
            var voices = window.speechSynthesis.getVoices();
            console.log(voices);
            if (voiceReady) {
                var utterThis = new SpeechSynthesisUtterance(message);           
                utterThis.rate = rate.value;
                utterThis.pitch = pitch.value;
                utterThis.volume = volume.value;
                
                switch (lang) {
                    case 'ru':
                        utterThis.voice = synth.getVoices()[15];
                        break;
                    case 'en':
                        utterThis.voice = synth.getVoices()[1];
                    break;
                    default:
                        utterThis.voice = synth.getVoices()[1];
                        break;
                }
                synth.speak(utterThis);
            }
        }
        var socket = io.connect('http://localhost:5000');
            socket.on('connect', function() {
                socket.emit('update', {username: '{{ username }}}'});
            });
            socket.on('ask', function(data) {
                console.log(data);
                var list = document.getElementById('demo');
                var entry = document.createElement('li');
                entry.appendChild(document.createTextNode(data.message));
                list.appendChild(entry);
                speak(data.message, data.lang);
            });
    </script>
    <ol id="demo">
    </ol>
</body>
</html>